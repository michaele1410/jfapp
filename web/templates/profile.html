{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
  <div class="col-12 col-lg-8">
    <div class="card shadow-sm mb-3">
      <div class="card-body">
        <h2 class="h6 mb-3">{{ _('Profil') }}</h2>
        <form action="{{ url_for('profile_post') }}" class="row g-3" method="post">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <div class="col-12">
            <label class="form-label">{{ _('E-Mail (f체r Passwort-Reset)') }}</label>
            <input class="form-control" name="email" type="email" value="{{ user.email or '' }}" />
          </div>

          <div class="col-12 col-md-6">
            <label class="form-label">{{ _('Neues Passwort') }}</label>
            <input class="form-control" name="password" placeholder="{{ _('leer lassen, um nicht zu 채ndern') }}" type="password" />
          </div>

          <div class="col-12 col-md-6">
            <label class="form-label">{{ _('Neues Passwort (Wiederholen)') }}</label>
            <input class="form-control" name="password2" placeholder="{{ _('leer lassen, um nicht zu 채ndern') }}" type="password" />
          </div>

          <div class="col-12 d-flex gap-2">
            <a class="btn btn-outline-secondary" href="{{ url_for('bbalance_routes.index') }}">{{ _('Abbrechen') }}</a>
            <button class="btn btn-primary">{{ _('Speichern') }}</button>
          </div>
        </form>
      </div>
    </div>

    <div class="card shadow-sm mb-3">
      <div class="card-body">
        <h2 class="h6 mb-3">{{ _('2-Faktor-Authentifizierung') }}</h2>
        {% if user.totp_enabled %}
        <p class="text-success">{{ _('2FA ist') }} <strong>{{ _('aktiviert') }}</strong>.</p>
        <form action="{{ url_for('disable_2fa') }}" class="row g-2 align-items-end" method="post">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <div class="col-12 col-md-6">
            <label class="form-label">{{ _('Best채tige mit Passwort') }}</label>
            <input class="form-control" name="password" required="" type="password" />
          </div>
          <div class="col-12 col-md-6">
            <button class="btn btn-outline-danger">{{ _('2FA deaktivieren') }}</button>
          </div>
        </form>
        {% else %}
        <p class="text-muted">{{ _('2FA ist aktuell') }} <strong>{{ _('deaktiviert') }}</strong>.</p>
        <form action="{{ url_for('enable_2fa') }}" method="post">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <button class="btn btn-outline-primary">{{ _('2FA einrichten') }}</button>
        </form>
        {% endif %}
        
        {% if new_backup_codes %}
        <div class="alert alert-warning">
          <h5 class="mb-2">{{ _('Ihre neuen Backup-Codes (einmalig sichtbar):') }}</h5>
          <pre class="mb-0">{{ '\n'.join(new_backup_codes) }}</pre>
        </div>
        {% endif %}
      </div>
    </div>

    <div class="card shadow-sm mb-3">
      <div class="card-body">
        <h2 class="h6 mb-3">{{ _('System') }}</h2>
        <form method="post" action="{{ url_for('update_preferences') }}" class="row g-3">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <!-- Sprache -->
          <div class="col-12 col-md-6">
            <label for="language" class="form-label">{{ _('Sprache:') }}</label>
            <select id="language" name="language" class="form-select">
              <option value="de" {{ 'selected' if user['locale'] == 'de' else '' }}>{{ _('Deutsch') }}</option>
              <option value="en" {{ 'selected' if user['locale'] == 'en' else '' }}>{{ _('Englisch') }}</option>
            </select>
          </div>
          <!-- Darstellung -->
          <div class="col-12">
            <label class="form-label">{{ _('Darstellung') }}</label>
          </div>
          <div class="col-12">
            <div class="btn-group" role="group">
              <input type="radio" class="btn-check" name="theme" id="theme-system" value="system" autocomplete="off"
                    {% if theme_preference == 'system' %}checked{% endif %}>
              <label class="btn btn-outline-secondary" for="theme-system">{{ _('System') }}</label>
              <input type="radio" class="btn-check" name="theme" id="theme-light" value="light" autocomplete="off"
                    {% if theme_preference == 'light' %}checked{% endif %}>
              <label class="btn btn-outline-secondary" for="theme-light">{{ _('Hell') }}</label>
              <input type="radio" class="btn-check" name="theme" id="theme-dark" value="dark" autocomplete="off"
                    {% if theme_preference == 'dark' %}checked{% endif %}>
              <label class="btn btn-outline-secondary" for="theme-dark">{{ _('Dunkel') }}</label>
            </div>
          </div>
          <!-- Speichern -->
          <div class="col-12 d-flex gap-2">
            <button class="btn btn-primary mt-2">{{ _('Speichern') }}</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}